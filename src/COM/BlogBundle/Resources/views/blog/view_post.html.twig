{% extends "COMBlogBundle::blog.html.twig" %}

{% block title %}
  Blog - {{ post.title }}
{% endblock %}


{% block blog_body %}
	<div class="cr">
		<div class="mg_v10">
			<div class="ct">
				<div class="mg_10" style="font-weight:bold;">
					<span style=" font-size:16px; color:#555">{{ post.title }}</span>
				</div>
				<div class="mg_10">
					By 
					{# twig extension #}
					{% set userInfo = getLinkUserInfo(post.user, post.user.name) %} 
					{{ userInfo | raw }}
					  on {{ post.date | date('Y-m-d H:i:s') }}
				</div>
				<div class="mg_10">
					{{ post.content | raw }}
				</div>
				
				{% if is_granted("IS_AUTHENTICATED_REMEMBERED") %}
					<div class="mg_10" style="background:#f5f5f5; border:1px solid #7ae; padding:5px; border-radius:3px;box-sizing:border-box"> 
						<div>Actions admin : </div>
						<div class="sp mg_v5"></div>
						<div>
						{% if is_granted('ROLE_ADMIN') %}<a href="{{ path('com_admin_blog_post_edit', {'id': post.id}) }}" target="_blank"><span>Manage</span></a>{% endif %}&nbsp;
						
							{% set schools = getNotSchoolsByPostAndUser(post, app.user) %} 
							{% if schools %}
								
								<span class="dd" style="display:inline-block;" id="btn_add_to_sl">
									<span href="#" class="dd_src" style="cursor:pointer">
										Add to ...
									</span>
									<div class="dd_target" style="margin-top: 3px; position: absolute; display: none; border: 1px solid rgb(170, 170, 170); border-radius: 4px;background:#fff;box-shadow: 1px 1px 5px #ccc;">
										<div style="margin:5px">
												{% for school in schools %}
													<div style="cursor:pointer" data-schoolId="{{ school.id }}" data-target="{{ path('com_blog_post_set_post_school', {'post_id': post.id, 'school_id': school.id}) }}" class="not_school_post">{{ school.shortName }} - {{ school.name }}</div>
												{% endfor %}
										</div>
									</div>
								</span> 
							{% endif %}
						</div>
					</div>
				{% endif %}
				
				<div class="sp mg_v10"></div>
				<div id="info_comment" class="mg_h10">
					{{ comments | length }} 
					{% if comments | length == 0 or comments | length == 1 %}
						Commentaire
					{% else %}
						Commentaires
					{% endif %}
				</div>
				<div class="sp mg_v10"></div>
				
				<div>
					<div id="bg_post_list_cmt">
						{% for comment in comments %}
							{{ include("COMBlogBundle:blog:include/comment_item.html.twig") }}
						{% endfor %}
					</div>
					<div class="both"></div>
					{% if is_granted("IS_AUTHENTICATED_REMEMBERED")%}
						<div class="mg_10">
							<form action="" name="" method="post" id="">
								<div class="mg_b5">
								{{ app.user.name }} :
								</div>
								<div style="width:60px;float:left">
									{% set avatar=userAvatar(app.user) %}
									{% if avatar != "default.jpeg" %}
										{% set pathtoavatar='uploads/images/user/avatar/'~avatar %}
									{% else %}
										{% set pathtoavatar='default/images/user/avatar/'~avatar %}
									{% endif %}
									<span style="display:block;float:left;"><img id="avatar_banner" style="width:60px; height: 60px" src="{{ pathtoavatar | imagine_filter('60x60') }}" alt="{{ app.user.username }}" /></span>
								</div>
								<div style="margin-left:70px">
									<textarea class="default_textarea" id="bg_post_cmt_message" style="min-height:120px"></textarea>
									<div class="mg_t5">
										<span class="btn_save standar_button btn_bg_post_new_cmt" data-target="{{ path('com_blog_post_new_comment', {'post_id': post.id}) }}">R&eacute;pondre</span>
									</div>
								</div>
								<div class="both"></div>
							</form>
						</div>
					{% else %}
						<div class="mg_v10">
							<a class="link" href="{{ path('com_user_login') }}">Connectez-vous pour pouvoir ecrire votre message</a>
						</div>
					{% endif %}
				</div>
			</div>
		</div>
	</div>
{% endblock %}
