{% extends "COMAdminBundle::admin.html.twig" %}

{% block title %}
	posts lists
{% endblock %}

{% block body_header %}
	<div class="bc">
		<span class="bc1"><a href="{{ path('com_admin_blog') }}"><img src="{{ asset('assets/image/bg_icon.png') }}" style="width:14px; height:auto" /> <span>{{ 'Blog' | trans }}</span></a></span> 
	</div>
	<div style="padding:8px;float:right">
		<span><a href="{{ path('com_admin_blog_post_add') }}"><img src="{{ asset('assets/image/add_icon.png') }}" /> <span>New post</span></a></td></span> 
	</div>
{% endblock %}

{% block content_body %}
	<div style="background:#ddd; padding: 5px; margin:5px; border:1px solid #bbb">
		<span><img src="{{ asset('assets/image/list_icon.png') }}" style="width:12px; height:auto" /> posts lists</span>
	</div>
	
	<div class="a_datatable">
		<div class="a_datatable_head">
			<div class="a_datatable_head_left">
				<span style="display:inline-block; margin-top:5px; margin-left:6px"> Search : <input type="text" class="default_input a_list_search_input" data-target-id="list_posts" /></span>
			</div>
			<div class="a_datatable_head_right">
				{#right#}
			</div>
		</div>
		
		<div class="a_datatable_body">
			<table class="a_table" id="list_posts">
				<tr class="a_table_head">
					<th class="a_table_cell_id" style="width: 50px; text-align:center">id</th>
					<th class="taleft">default title</th>
					<th class="taleft">author</th>
					<th class="taleft">Published</th>
					<th class="taleft">Valid</th>
					<th class="taleft">Deleted</th>
					<th class="a_table_cell_action">action</th>
				</tr>
				{% for post in posts %}
				<tr class="a_table_line" data-text="{{ post.defaultTitle }}" style="display:table-row">
					<td class="a_table_cell_id" style="width: 50px; text-align:center">{{ post.id }}</td>
					<td>					
						{# twig extension #}
						{% set illustration=postIllustration(post) %}
						{% if illustration != "default.jpeg" %}
							{% set path='uploads/images/post/illustration/'~illustration %}
						{% else %}
							{% set path='default/images/post/illustration/'~illustration %}
						{% endif %}
						<a href="{{ path('com_admin_blog_post_edit', {'id': post.id}) }}" style="display:block;">
							<span style="display:block;float:left;width:32px; margin:1px"><img id="post_illustration" style="width: 32px; height: 32px;display:block" src="{{ path | imagine_filter('32x32') }}" alt="img post" /></span>
							<span style="display:block;margin-left:36px;padding-top:6px" title="{{ post.defaultTitle }}">{{ substrSpace(post.defaultTitle, 60) }}</span>
							<span class="both"></span>
						</a>
					</td>
					{#
						{% set avatar=userAvatar(post.user) %}
						{% if avatar != "default.jpeg" %}
							{% set pathtoavatar='uploads/images/user/avatar/'~avatar %}
						{% else %}
							{% set pathtoavatar='default/images/user/avatar/'~avatar %}
						{% endif %}
						
						<td>
							<span style="display:block;float:left;width:32px"><img id="avatar_banner" style="width:30px; height: 30px" src="{{ pathtoavatar | imagine_filter('32x32') }}" alt="{{ post.user.username }}" /></span>
							<span style="display:block;margin-left:36px;padding-top:6px">{{ post.user.name }}</span>
							<span class="both"></span>
						</td>
					#}
					<td>
						<span>
							<span class="toggle_showAuthorState_post" data-target="{{ path('com_blog_manager_post_toogle_show_author', {'post_id': post.id}) }}">
								{% if post.showAuthor %}
									<span class="greenstate" style="display:none"><span class="greenpastille"></span></span>
									<span class="redstate"><span class="redpastille"></span></span>
								{% else %}
									<span class="greenstate"><span class="greenpastille"></span></span>
									<span class="redstate" style="display:none"><span class="redpastille"></span></span>
								{% endif %}
							</span> 
							<span>{{ post.user.name }}</span>
						</span>
					</td>
					<td>
						<span class="toggle_publishState_post" data-target="{{ path('com_blog_manager_post_toogle_publication', {'post_id': post.id}) }}">
							{% if post.published %}
								<span class="greenstate" style="display:none"><span class="greenpastille"></span></span>
								<span class="redstate"><span class="redpastille"></span></span>
							{% else %}
								<span class="greenstate"><span class="greenpastille"></span></span>
								<span class="redstate" style="display:none"><span class="redpastille"></span></span>
							{% endif %}
						</span>
					</td>
					<td>
						<span class="toggle_validState_post" data-target="{{ path('com_blog_manager_post_toogle_validation', {'post_id': post.id}) }}">
							{% if post.valid %}
								<span class="greenstate" style="display:none"><span class="greenpastille"></span></span>
								<span class="redstate"><span class="redpastille"></span></span>
							{% else %}
								<span class="greenstate"><span class="greenpastille"></span></span>
								<span class="redstate" style="display:none"><span class="redpastille"></span></span>
							{% endif %}
						</span>
					</td>
					<td>
						<span class="toggle_deleteState_post" data-target="{{ path('com_blog_manager_post_toogle_deletion', {'post_id': post.id}) }}">
							{% if post.deleted %}
								<span class="greenstate" style="display:none"><span class="greenpastille"></span></span>
								<span class="redstate"><span class="redpastille"></span></span>
							{% else %}
								<span class="greenstate"><span class="greenpastille"></span></span>
								<span class="redstate" style="display:none"><span class="redpastille"></span></span>
							{% endif %}
						</span>
					</td>
					<td class="a_table_cell_action">action</td>
				</tr>
				{% endfor %}
			</table>
		</div>
		
		<div class="a_datatable_foot">
			<div class="a_datatable_foot_left">
				<span style="display:inline-block; margin-top:6px; margin-left:6px" class="result_state">{{ posts | length }} resultat(s)</span>
			</div>
			<div class="a_datatable_foot_right">
				{#
				<span>right</span> 
				<span>1</span> 
				<span>2</span> 
				<span>3</span> 
				#}
			</div>
		</div>
	</div>
{% endblock %}

{% block body_footer %}
	<span style="display:inline-block; margin-top:6px; margin-left:6px">{{ posts | length }} posts</span> | 
	<span style="display:inline-block; margin-top:6px; margin-left:6px">{{ publishedPosts | length }} published posts</span> | 
	<span style="display:inline-block; margin-top:6px; margin-left:6px">{{ notPublishedPosts | length }} not published posts</span> 
{% endblock %}

